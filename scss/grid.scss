@import "grid-math.scss";

%clearfix {
  &::after {
    content: "";
    display: table;
    clear: both;
  }
}

// Media of at least the minimum breakpoint width. No query for the smallest breakpoint.
// Makes the @content apply to the given breakpoint and wider.
@mixin media-breakpoint-min($min) {
  @if $min {
    @media (min-width: $min) {
      @content;
    }
  } @else {
    @content;
  }
}

// Base col styles
%col {
  float: left;
  // Prevent empty column collapse
  min-height: 1px;  
  width: 100%;
}

@mixin col-base($span, $breakpoint, $ns: '') {
  .#{$ns}col-#{$breakpoint}-#{$span} {
    @extend %col;
  }
}

// Create a column by specifying colspan, grid column width, gutter width.
//
// - `$colspan`: the colspan of the column.
// - `$column`: a single column width.
// - `$gutter`: gutter width
// - `$breakpoint`: a keyword for the breakpoint
// - `$ns`: an optional namespace for grid classes.
@mixin col($span, $column, $gutter, $breakpoint, $ns: '') {
  .#{$ns}col-#{$breakpoint}-#{$span} {
    padding-left: ($gutter / 2);
    padding-right: ($gutter / 2);
    width: colspan($span, $column, $gutter);
  }
}

@mixin row($gutter, $ns: '') {
  .#{$ns}row {
    margin-left: -1 * ($gutter / 2);
    margin-right: -1 * ($gutter / 2);
  }
}

%container {
  margin-left: auto;
  margin-right: auto;
}

@mixin container-base($gutter, $ns: '') {
  .#{$ns}container {
    @extend %container;
    padding-left: $gutter;
    padding-right: $gutter;
  }
}

@mixin container($span, $column, $gutter, $ns: '') {
  .#{$ns}container {
    width: colspan($span, $column, $gutter);
  }
}

// Generate a grid breakpoint
@mixin grid($columns, $column, $gutter, $breakpoints, $ns: '') {
  $width: colspan($columns, $column, $gutter);
  @include container($columns, $column, $gutter, $ns);
  @include row($gutter, $ns);
  @each $breakpoint in $breakpoints {
    @for $span from 1 through $columns {
      @include col($span, $column, $gutter, $breakpoint, $ns);
    }
  }
}

@mixin grid-system($columns, $width-sm, $width-md, $width-lg, $width-xl, $gutter, $unit: 1, $ns: '') {
  $gutter: fit-gutter($gutter, $unit);

  // Debug causes columns to be rendered with a semi-transparent background
  // assisting in layout debugging.
  .#{$ns}debug [class*="#{$ns}col"] {
    background-color: rgba(255, 120, 0, 0.3);
    box-shadow: inset 0 0 0 1px rgba(255, 120, 0, 0.3);
  }

  .#{$ns}row {
    @extend %clearfix;
  }

  @include container-base($gutter, $ns);

  @for $span from 1 through $columns {
    @include col-base($span, 'sm', $ns);
    @include col-base($span, 'md', $ns);
    @include col-base($span, 'lg', $ns);
    @include col-base($span, 'xl', $ns);
  }

  @include media-breakpoint-min($width-sm) {
    $column-sm: fit-col($columns, $width-sm - ($gutter * 2), $gutter, $unit);
    @include grid($columns, $column-sm, $gutter, ('sm'), $ns);
  }

  @include media-breakpoint-min($width-md) {
    $column-md: fit-col($columns, $width-md - ($gutter * 2), $gutter, $unit);
    @include grid($columns, $column-md, $gutter, ('sm', 'md'), $ns);
  }

  @include media-breakpoint-min($width-lg) {
    $column-lg: fit-col($columns, $width-lg - ($gutter * 2), $gutter, $unit);
    @include grid($columns, $column-lg, $gutter, ('sm', 'md', 'lg'), $ns);
  }

  @include media-breakpoint-min($width-xl) {
    $column-xl: fit-col($columns, $width-xl - ($gutter * 2), $gutter, $unit);
    @include grid($columns, $column-xl, $gutter, ('sm', 'md', 'lg', 'xl'), $ns);
  }
}